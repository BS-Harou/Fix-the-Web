<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="images/icon-18.png" />
    <title>Seçenekler | Fix the Web</title>

    <style type="text/css">
    @import 'styles/modal_styles.css';
    @import 'styles/options_styles.css';
    </style>
</head>
<body>
    <div id="nav"></div><!--This tab bar is automatically filled with JS.-->

    <!-- To create a new tab, simply create a new <section> element with an ID. The ID will be the title of the tab. -->
    <section id="preferences">
        <h1>Fix the Web <span class="light"> Seçenekler</span></h1>

        <form id="prefs-form">
                <div class="sub_section">
                    <label>CSS yamaları için güncellemeleri denetleme aralığı
                        <input type="range" min="0" max="960" step="60" name="update-interval" id="update-interval" />
                        <em><span id="update-interval-value"></span></em>
                    </label>

                    <div>
                        <div id="update">CSS yamaları için güncellemeleri şimdi denetle</div>
                    </div>
                </div>

                <p class="sub_section">
                    Araç çubuğu simgesindeki hata sayısını şuna göre göster:
                    <input type="radio" id="display-reports-by-domain" name="display-reports-by" value="domain" />
                    <label for="display-reports-by-domain">
                        <strong>alan adı</strong>
                    </label>
                    <input type="radio" id="display-reports-by-page" name="display-reports-by" value="page" />
                    <label for="display-reports-by-page">
                        <strong>sayfa</strong>
                    </label>
                </p>
                <div class="sub_section">
                    Make CSS3 properties coded for other browsers <strong><a href="https://addons.opera.com/addons/extensions/details/css-prefixr" title="Feature derived from Christoph142's CSS3 Prefixr extension">work in Opera too</a></strong>?
                    <input type="radio" name="prefixr" value="true" id="prefixr-on" />
                    <label for="prefixr-on">
                        <strong>Enable</strong>
                    </label>
                    <input type="radio" name="prefixr" value="false" id="prefixr-off" />
                    <label for="prefixr-off">
                        <strong>Disable</strong>
                    </label>

                    <div>
                        <label for="prefixr-exclude">Don't run Prefixr on these sites <em>(one site per line)</em>:</label>
                        <textarea name="prefixr-exclude" id="prefixr-exclude" cols="60" rows="7" title="one site per line; don't include the protocol (e.g. http://)" placeholder="exclude.com"></textarea>
                    </div>
                </div>
                <div class="sub_section">
                    Browser Identification (<abbr title="Will mask Javascript properties as the selected browser. However, the user-agent string sent in the HTTP request can not be masked by the extension. To do that, right-click the page, select Edit Site Preferences..., and go to Network &gt; Browser Identification">about</abbr>): 
                    
                    <input type="radio" name="browser-id" value="opera" id="as-opera" />
                    <label for="as-opera">
                        <strong>Opera (default)</strong>
                    </label>
                    
                    <input type="radio" name="browser-id" value="ie" id="as-ie" />
                    <label for="as-ie">
                        <strong>Internet Explorer</strong>
                    </label>
                    
                    <input type="radio" name="browser-id" value="firefox" id="as-firefox" />
                    <label for="as-firefox">
                        <strong>Firefox</strong>
                    </label>
                    
                    <input type="radio" name="browser-id" value="chrome" id="as-chrome" />
                    <label for="as-chrome">
                        <strong>Chrome</strong>
                    </label>
                </div>
        </form>
        <!--
    </section>
    <section id="authenticate">-->
<!--        <h1>Fix the Web <span class="light"> Authentication</span></h1>-->
        <form id="auth" class="hide sub_section">
            <p>
                <a href="#" id="twitter-login"></a>
<!--                <a href="#" id="facebook-login"></a>-->
            </p>

            <p>
                <input type="text" placeholder="PIN number" size="30" id="pin-number" required="required" />
                <button type="submit">Bağlan</button>
            </p>

            <button disabled="disabled">Opera hesabınızla bağlanın</button>
            <em>(Opera API'si henüz bunu desteklemiyor. Twitter ile bağlanabilirsiniz.)</em>
        </form>

        <p id="loading"><img src="images/loading-circle.png" alt="Yükleniyor" title="Yükleniyor..." /></p>

        <p id="connected" class="hide">Şu anda Twitter hesabınıza bağlı durumdasınız.<strong><a href="#" id="disconnect">disconnect</a></strong></p>

        <ul id="recent-posts"></ul><!--populated by Javascript-->
    </section>
    <section id="about">
        <h1>Fix the Web <span class="light"> Hakkında</span></h1>

        <p>Fix the Web açık kaynaklıdır. Projeye Github üzerinden katkıda bulunabilirsiniz:</p>

        <ul>
            <li><strong><a href="http://my.opera.com/fix-the-web">My Opera <em>Fix the Web</em> Grubu</a></strong> (destek, blog, forumlar vb.)</li>
            <li><strong><a href="http://www.operaturkiye.net/fix-the-web">Ana Sayfa</a></strong> (yapım aşamasında)</li>
            <li><strong><a href="http://github.com/cyberstream/Fix-the-Web">Temel eklenti dosyaları deposu</a></strong></li>
            <li><strong><a href="http://github.com/cyberstream/Fix-the-Web-Server-Side">Sunucu tarafı deposu</a></strong></li>
            <li><strong><a href="http://github.com/cyberstream/Fix-the-Web-CSS-Patches">CSS Yamaları</a></strong> (Eğer bir web sitesi yalnızca CSS yaması gerektiriyorsa, yamayı depodaki <em><strong>patches.json</strong></em> dosyasına ekleyin. Sorunlu web sitesi yama için JS'e ihtiyaç duyuyorsa, <em><strong>patch.js</strong> dosyasını içerecek şekilde</em> <a title="Fix the Web's Repository" href="http://github.com/cyberstream/Fix-the-Web">eklenti deposu</a>na yerleştirin.)</li>
        </ul>
            
        <div id="columnize">            
            <div>
                <h4>Katkıda bulunanlar:</h4>
            
                <ul>
                    <li><strong><a href="http://my.opera.com/cyberstream">cyberstream</a></strong> <a href="mailto:cyberstream@myopera.com">(e-posta)</a></li>
                    <li><strong><a href="http://my.opera.com/greench">greench</a></strong> <a href="mailto:greench@myopera.com">(e-posta)</a></li>
                    <li><strong><a href="http://my.opera.com/inbuster">inbuster</a></strong> <a href="mailto:inbuster@myopera.com">(e-posta)</a></li>
                    <li><strong><a href="http://my.opera.com/metude">metude</a></strong> <a href="mailto:metude@myopera.com">(e-posta)</a></li>
                    <li><strong><a href="http://my.opera.com/zahek">zahek</a></strong> <a href="mailto:zahek@myopera.com">(e-posta)</a></li>
                    <li><strong><a href="http://my.opera.com/BS-Harou">BS-Harou</a></strong></li>
                </ul>
            </div>
            
            <div>
                <h4>Thanks:</h4>
                
                <ul>
                    <li><strong><a href="http://my.opera.com/AntonDiaz">AntonDiaz</a></strong> (Added CSS fixes from his <strong><a href="https://addons.opera.com/addons/extensions/details/twitter-fix">Twitter Fix</a></strong> extension)</li>
                    <li><strong><a href="http://my.opera.com/Christoph142">Christoph142</a></strong> (Based the <strong>-o- prefix</strong> feature off of his <strong><a href="https://addons.opera.com/addons/extensions/details/css-prefixr/">CSS Prefixr</a></strong> extension)</li>
                </ul>
            </div>
        </div>
    </section>

    <footer>
        <a href="index.html">Son Raporlar Listesi</a>
    </footer>

    <script type="text/javascript" src="scripts/background.js"></script>
    <script type="text/javascript" src="scripts/jsOAuth-1.3.3.min.js"></script>
    <script type="text/javascript" src="scripts/jquery-1.6.4.min.js"></script>
    <script type="text/javascript" src="scripts/jquery.simplemodal.1.4.2.min.js"></script>
    <script type="text/javascript">
        $.support.cors = true;

        // get recent blog posts from Fix the Web's blog
        $(function() {
            $.get('http://my.opera.com/fix-the-web/xml/rss/blog', function(data) {
                var items = $('item', data);

                // populate the list with the the 7 most recent blog posts
                for (i in items) {
                    if ( i > 7 ) break;
                    if ( !items[i] || typeof items[i].getElementsByTagName != 'function' || i == 'context' ) continue;

                    var link = items[i].getElementsByTagName('link')[0].firstChild.nodeValue,
                          title = items[i].getElementsByTagName('title')[0].firstChild.nodeValue,
                          time = items[i].getElementsByTagName('pubDate')[0].firstChild.nodeValue
                          
                    try {
                        time = new Date(time);
                        
                        switch( Math.floor ((new Date() - time) / (1000 * 60 * 60 * 24)) ) { // this is the number of days since the article was posted
                            case 0 :
                                time = 'posted today'
                                break;
                            case 1 :
                                time = 'posted yesterday'
                                break;
                            case 2 : 
                                time = 'posted two days ago'
                                break;
                            case 3 :
                                time = 'posted three days ago'
                                break;
                            case 4 :
                                time = 'posted four days ago'
                                break;
                            case 5 :
                                time = 'posted five days ago'
                                break;
                            case 6 : 
                                time = 'posted six days ago'
                                break;
                            case 7 :
                                time = 'posted a week ago'
                                break;
                            default:
                                time = 'posted on ' + time.toLocaleDateString();
                        }                         
                        
                    } catch (e) {
                        time = '';
                    }

                    $('<li><a href="' +link+ '" title="Click to read this post" target="_blank">' +title+ '</a> <strong class="light">' +time+ '</strong></li>').appendTo('#recent-posts');
                }

                if ($('#recent-posts').children().length) {
                    $('<h3 id="blog-header"><span class="light">Latest Posts on</span> <a href="http://my.opera.com/fix-the-web/blog">Fix the Web\'s Blog</a></h3>').insertBefore('#recent-posts')

                    var k = -1,
                          posts = $('#recent-posts').children();

                    function loop () {
                        var previous = k;

                        if (k + 1 == posts.length) k = 0;
                        else k++;

                        $(posts[previous]).removeClass('current');
                        $(posts[k]).addClass('current');

                        setTimeout(loop, 4000);
                    }

                    loop();
                }
            });
        });

    var form = document.getElementById("prefs-form"),
          fields = form.querySelectorAll("input[type='range'], input[type='radio'], textarea");
    var sliderOptions = {
        '780': 'every day',
        '840': 'every three days',
        '900': 'every week',
        '960': 'manually only',
        '0': 'every time you start Opera'
    }

    // Set the preference values for each field
    function savePrefs (event) {
        if (event.target.name == 'display-reports-by') {
            widget.preferences.setItem(event.target.name, event.target.id.replace('display-reports-by-', ''));
        } else if (event.target.name == 'update-interval') {
            widget.preferences.setItem('update-interval', event.target.value);
        } else if (event.target.name == 'prefixr-exclude') {            
            var sites = $('#prefixr-exclude').val(); 
            
            widget.preferences.setItem('prefixr-exclude', JSON.stringify(sites.split(/\r?\n/)))            
        } else widget.preferences.setItem(event.target.name, event.target.value);
    }

    // Get the preference values from the widget object
    function loadPrefs() {
        for (var i = 0; i < fields.length; i++) {
            var field = fields[i];
            if (typeof widget.preferences[field.name] !== "undefined") {
                if (field.getAttribute('type') == 'radio') {
                    if (widget.preferences.getItem(field.name) == field.value) field.checked = 'checked';
                } else if (field.id == 'prefixr-exclude') {
                    if ( widget.preferences.getItem('prefixr-exclude') ) {
                        try {
                            var excluded_sites = JSON.parse(widget.preferences.getItem('prefixr-exclude'));
                            
                            field.value = excluded_sites.join('\n');
                        } catch(e) {}
                    } else widget.preferences.setItem('prefixr-exclude', '[]')  
                } else field.value = widget.preferences.getItem(field.name)
            }
            
            field.addEventListener("change", savePrefs, false);
        }

        updateIntervalValue();
    }

    function readableInterval (minutes) {
        var minutes = parseInt(minutes),
              readable,
              prepend = 'every ';

        if ( minutes == 60 ) readable = 'saat';
        else if ((minutes > 720 && minutes % 60 == 0) || minutes == 0) readable = sliderOptions[minutes], prepend = '';
        else if ( minutes == 30 ) readable = 'yarım saat';
        else if ( minutes % 60 == 0 ) readable = (minutes / 60) + ' saat';
        else if ( minutes % 60 == 30 ) readable = (minutes - 30) / 60 + '.5 saat';
        else readable = minutes + ' dakika';

        return prepend + readable;
    }

    // That function shows update-interval's value on a visible HTML element
    function updateIntervalValue () {
        var interval = parseInt(document.getElementById("update-interval").value);

        document.getElementById("update-interval-value").innerText = readableInterval(interval);
    }

    // when the page is loaded, get extension preferences and assign them into correct input elements
    window.addEventListener("load", function() {
        loadPrefs()

        if (location.hash == '' || !document.getElementById(location.hash.replace('#', ''))) location.hash = 'preferences'
        else document.getElementById(location.hash.replace('#', '')).className = 'active';

        var sections = document.querySelectorAll("section"),
              nav = document.getElementById('nav'),
              currentSection = document.getElementById(location.hash.replace('#', ''));

        currentSection.className = 'active';

        for (i = 0; i < sections.length; i++) {
            var thisID = sections[i].id;
            activeClass = ('#' + thisID == location.hash ? ' class="active"' : '');

            nav.innerHTML += '<a href="#' +thisID + '" id="' +thisID + '-tab"' +activeClass+ '>' +thisID+ '</a>';
        }
    }, false);

    // when update interval is changed, update the value in the isible area
    document.getElementById("update-interval").addEventListener("change", updateIntervalValue, false);

    document.getElementById('update').addEventListener('click', function() {
        var loading = document.createElement('img'),
              update_button = document.getElementById('update');

        loading.src = 'images/loading.png';
        loading.id = 'loading_spinner';

        if (!document.getElementById('loading_spinner')) update_button.parentNode.insertBefore(loading, update_button.nextSibling);

        var updated = update(function(u) {
            if (document.getElementById('loading_spinner')) loading.parentNode.removeChild(loading);

            if (u == 2) $.modal('CSS yamaları dosyası başarıyla güncellendi!', { overlayClose: true });
            else if (u == 1) $.modal('Son güncellemeden beri CSS yamalarında herhangi bir değişiklik yapılmadı.', { overlayClose: true });
            else $.modal('CSS yamaları dosyası güncellenirken bir hata oluştu' + (u != 0 ? ': \n\n' + u : '.'), { overlayClose: true });
        });
    }, false)

    function freezeClick(e) {
        e.preventDefault()
    }

    window.addEventListener('hashchange', function() {
        var lastTab = document.querySelector('a.active'),
              lastSection = document.querySelector('section.active'),
              currentHash = location.hash.replace('#', '') || '',
              currentTab = document.getElementById(currentHash + '-tab'),
              currentSection = document.getElementById(currentHash);

        if (currentHash == '' || !currentSection) { // don't allow the URL to change to an empty hash
            location.hash = 'preferences';
            return;
        }

        lastTab.className = '';
        lastSection.className = 'inactive';
        currentTab.className = 'active';

        // cancel any click events temporarily to fix the problem of tabs not working after you click a non-active tab during animation
        window.addEventListener('click', freezeClick, false);

        setTimeout(function() {
            lastSection.className = '';
            currentSection.className = 'active';

            // remove the "click freeze"
            window.removeEventListener('click', freezeClick, false);
        }, 600)
    }, false);

    // OAuth authentication

    if ( isLoggedIn() ) {
        $('#connected').removeClass('hide');
        $('#loading').attr('class', 'hide');
    } else {
        $('#auth').removeClass('hide');
        $('#loading').attr('class', 'hide');
    }

    // disconnect from your Twitter account
    $('#disconnect').click(function(e) {
        e.preventDefault ();

        $('#connected').fadeOut(500, function() {
            widget.preferences.access_token = ''; // remove the access token from local storage

            $('#auth').removeClass('hide');
            $('#auth').css('opacity', 0).animate({
                opacity: 1
            }, 650);
        });
    });

    $('#auth').bind('submit', function() {
        $.modal ('Bir PIN numarası girmeden önce "<strong>Sign in with Twitter</strong>" düğmesine tıklayın.', { overlayClose: true });

        return false;
    });

    $('#twitter-login').click(function() { // Twitter OAuth
        oauth = new OAuth(CONFIG.twitter);
        oauth.fetchRequestToken(function(url) {
            window.open(url, 'authorise', 'width=700,height=400,resizable=no');
        }, failureHandler);

        $.modal ('Bu uygulamayı Twitter üzerinde yetkilendirmenizi isteyen bir pencere açılmalıldır. "Fix the Web" uygulamasını yetkilendirdikten sonra, Twitter tarafından verilen PIN numarasını kopyalayın ve oturum açma düğmesinin altındaki metin kutusuna yapıştırın.', {maxWidth: Math.abs(window.innerWidth - 150), overlayClose: true})

        $('#auth').unbind('submit'); // detach the previously attached event handler

        $('#auth').bind('submit', function() { // add new event handler
            var pin = $('#pin-number', this).val();

            if (!pin || !pin.length) $.modal('Lütfen Twitter tarafından verilen PIN numarasını girin.', { overlayClose: true })
            else {
                $('#auth').fadeTo(500, 0.4);

                oauth.setVerifier (pin);

                oauth.fetchAccessToken(function(data) {
                    var query_string = parseQueryString(data.text),
                          oauth_access_token = query_string.oauth_token || '',
                          oauth_access_secret = query_string.oauth_token_secret || '';

                    widget.preferences.access_token = oauth_access_token + '|' + oauth_access_secret;

                    // hide authorization form and show the "logged in" paragraph
                    $('#auth').addClass('hide');
                    $('#connected').removeClass('hide');

                    $.modal('Oturum açtınız!', { overlayClose: true });
                }, failureHandler);
            }

            return false;
        });

        return false;
    });

    function failureHandler (data) { data ? console.log(data) : console.log('İstek gerçekleştirilemedi') }

    // parses a query string and returns
    function parseQueryString (a,b,c,d,e) {for(b=/[?&]?([^=]+)=([^&]*)/g,c={},e=decodeURIComponent;d=b.exec(a.replace(/\+/g,' '));c[e(d[1])]=e(d[2]));return c;}
    </script>
</body>
</html>